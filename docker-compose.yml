# ============================================
# Docker Compose - CV Builder with Watch
# ============================================

services:
  # Tek seferlik build
  cv-builder:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: latex-cv-builder
    volumes:
      - ./src:/cv/src:ro
      - ./output:/cv/output
    working_dir: /cv
    command: >
      sh -c "cd /cv/src && 
             pdflatex -interaction=nonstopmode -output-directory=/cv/output main.tex && 
             pdflatex -interaction=nonstopmode -output-directory=/cv/output main.tex"

  # Watch mode - dosya değişikliğinde otomatik derleme
  cv-watch:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: latex-cv-watch
    volumes:
      - ./src:/cv/src:ro
      - ./output:/cv/output
    working_dir: /cv
    command: >
      sh -c "
        echo '========================================';
        echo '  LaTeX CV - Watch Mode';
        echo '  Dosya degisikliklerini izliyor...';
        echo '  Ctrl+C ile durdur';
        echo '========================================';
        
        while true; do
          cd /cv/src && pdflatex -interaction=nonstopmode -output-directory=/cv/output main.tex;
          echo '';
          echo '[OK] PDF guncellendi: output/main.pdf';
          echo 'Bekleniyor... (5 saniye)';
          echo '';
          sleep 5;
        done
      "
    profiles:
      - watch
